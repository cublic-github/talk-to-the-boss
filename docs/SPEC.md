# SPEC.md (仕様書)

## 1. 概要

### 1.1. システム目的
組織内に散在・属人化している知識やノウハウを集約し、対話AIを通じて共有する。これにより、社員の自己解決率を向上させ、特定のメンバー（特に経営層）への問い合わせ対応工数を削減することを目的とする。

### 1.2. ターゲットユーザー
社内の従業員（主にメンバー層）。

---

## 2. 機能仕様

### 2.1. URL設計

| URLパス | 画面 | アクセス |
| :--- | :--- | :--- |
| `/` | チャット画面 | Public（将来的には認証ユーザー） |
| `/admin` | ナレッジ管理画面 | 認証ユーザー（将来） |

### 2.2. チャット機能 (`/`)

#### 2.2.1. 初期表示
* ユーザーが初めて画面にアクセスした際、画面中央に入力フォームを表示し、AIからの挨拶メッセージ「こんにちは！何かお困りですか？」を提示する。

#### 2.2.2. 会話フロー
* ユーザーが質問を入力し送信すると、AIからの回答がチャット形式で表示される。
* AIはセッション内の会話履歴を記憶し、文脈を考慮した回答を行う。

#### 2.2.3. 逆質問機能
* ユーザーの質問が曖昧であるとAIが判断した場合、回答を試みる前に「〇〇について知りたい、ということでしょうか？」といったように、意図を確認するための質問を返す。

#### 2.2.4. 学習ループ機能
* AIがナレッジベース内に回答を見つけられなかった場合、`3.2.1`で定義されたメッセージと共に、「新しい情報を教える」ボタンを表示する。
* ユーザーがボタンをクリックすると、モーダルウィンドウまたは専用フォームが開き、`title`と`content`を入力できる。
* 送信されると、その内容は新しいナレッジとして`knowledge_base`コレクションに登録される。

#### 2.2.5. 将来的な便利機能（Phase 2）
* AIの回答をクリップボードにコピーするボタン。
* 回答に対するフィードバック（👍/👎）ボタン。

### 2.3. ナレッジ管理機能 (`/admin`)

#### 2.3.1. 基本機能（CRUD）
管理者は、ナレッジの新規作成（Create）、一覧表示（Read）、編集（Update）、削除（Delete）を行える。

#### 2.3.2. 一覧表示
* 登録されているナレッジの`title`, `category`（将来実装）, `updatedAt`を一覧で表示する。
* 各項目から編集画面、削除確認画面へ遷移できる。

#### 2.3.3. 作成・編集画面
* 以下のフィールドを入力・編集できるフォームを設ける。
    * **title (必須):** 文字列（String）
    * **content (必須):** 長文テキスト（Textarea）。Markdown記法に対応する。

#### 2.3.4. データフィールド
* **手動入力フィールド (Phase 1):**
    * `title`
    * `content`
* **自動付与フィールド:**
    * `id`: ドキュメント作成時にシステムが自動で生成する一意のID。
    * `createdAt`: ドキュメント作成日時をシステムが自動で記録する。
    * `updatedAt`: ドキュメントが更新されるたびに日時をシステムが自動で更新する。
* **将来的なフィールド (Phase 2):**
    * `category` (String)
    * `tags` (Array of Strings)

---

## 3. AI仕様

### 3.1. ペルソナ・口調
* **Phase 1:** Geminiモデルのデフォルト設定を利用する。特定のキャラクター設定は行わない。
* **Phase 2:** 必要に応じて、より丁寧なビジネスアシスタントのような口調に調整する。

### 3.2. 応答メッセージ定義

#### 3.2.1. ナレッジ不足時の応答
* 関連ナレッジが見つからなかった場合、以下の固定メッセージを返す。
    > 「申し訳ありませんが、私の知識ではわかりかねます。ただしい情報を教えていただければ、今後の回答のために記憶させていただきます。」

#### 3.2.2. システムエラー時の応答
* APIエラーなど、サーバー側で予期せぬ問題が発生した場合、以下の固定メッセージを返す。
    > 「現在システムに問題が発生しています。時間をおいて再度お試しください」

---

## 4. 非機能要件

### 4.1. 認証
* **Phase 1:** 認証機能は実装せず、システムはパブリックアクセスとする。
* **Phase 2:** Firebase Authenticationを導入し、指定されたGoogleアカウントドメインを持つユーザーのみがログイン・利用できるようにアクセス制御を行う。
